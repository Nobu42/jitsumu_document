**Windows Serverのよくある障害と対応法**

**1. ブート・起動トラブル**

  ------------------------------------------------------------------------------------------------------------
  **障害内容**               **原因**                          **対応方法**
  -------------------------- --------------------------------- -----------------------------------------------
  OSが起動しない             ブート領域の破損、Windows         回復モード → 「スタートアップ修復」 or bootrec
                             Updateの失敗                      /fixmbr

  ブルースクリーン（BSOD）   ドライバ不良、ハード障害          STOPコードを記録 → イベントビューアで詳細確認

  ログオンできない           GPOの設定ミス、プロファイル破損   別管理者でログオン、regeditでプロファイル修正
                                                               or 新規作成
  ------------------------------------------------------------------------------------------------------------

**2. ネットワークトラブル**

  --------------------------------------------------------------------------------------------------------------------------------------------
  **障害内容**                     **原因**                                    **対応方法**
  -------------------------------- ------------------------------------------- ---------------------------------------------------------------
  RDP接続できない                  ファイアウォール/ポリシー、ネットワーク断   wf.mscでポート確認（3389）、ping, ipconfig, route print

  名前解決できない                 DNSキャッシュ汚染、設定ミス                 ipconfig /flushdns、nslookupで確認

  ファイル共有にアクセスできない   SMB無効、共有設定ミス                       services.mscで「Workstation」「Server」確認、共有権限チェック
  --------------------------------------------------------------------------------------------------------------------------------------------

**3.  ドメイン・認証系**

  --------------------------------------------------------------------------------------------------------------------
  **障害内容**                   **原因**                                 **対応方法**
  ------------------------------ ---------------------------------------- --------------------------------------------
  ドメイン参加できない           時刻ズレ、名前解決失敗                   NTP設定確認、DNSでドメイン名が引けるか確認

  グループポリシー適用されない   GPOレプリケーションエラー                gpresult /r、dcdiag, repadmin /replsummary

  ユーザー認証エラー             ロックアウト、Kerberosチケット期限切れ   イベントID 4771等確認、klist purgeでリセット
  --------------------------------------------------------------------------------------------------------------------

**4. ディスク・リソース系**

  --------------------------------------------------------------------------------------------------------------------------------
  **障害内容**                        **原因**                        **対応方法**
  ----------------------------------- ------------------------------- ------------------------------------------------------------
  Cドライブが容量不足                 Windows Update, ログ,           cleanmgr, dism /Online /Cleanup-Image /StartComponentCleanup
                                      WinSxS肥大化                    

  サービス落ちる                      RAM不足、仮想メモリ設定不適切   メモリ使用状況を「リソースモニター」で確認、仮想メモリ調整

  スナップショット肥大化（Hyper-V）   差分が増えすぎて統合できない    マージ処理、または再スナップショット計画の見直し
  --------------------------------------------------------------------------------------------------------------------------------

**5. セキュリティ・ユーザー系**

  ---------------------------------------------------------------------------------------------------------------------
  **障害内容**                          **原因**                          **対応方法**
  ------------------------------------- --------------------------------- ---------------------------------------------
  アカウントロック頻発                  多要素認証ミス、端末キャッシュ    lockoutstatus.exeツールでロック元端末を特定

  Windows Defender暴走                  定義ファイル不具合、CPU使用率高   一時停止 or 更新確認、必要に応じて除外設定

  UAC（ユーザーアカウント制御）が邪魔   設定が厳しすぎる                  secpol.msc →
                                                                          「ユーザーアカウント制御の動作」見直し
  ---------------------------------------------------------------------------------------------------------------------

**初動対応チェックリスト（Windows Server用）**

  ------------------------------------------------------------------------------------
  **項目**                             **チェック内容**
  ------------------------------------ -----------------------------------------------
  **最近の更新**（KBパッチ）確認       Get-HotFix や「設定 → 更新とセキュリティ」

  **イベントビューア確認**             eventvwr.msc → システム・アプリケーションログ

  **サービス状態確認**                 services.msc または Get-Service（PowerShell）

  **タスクマネージャでリソース確認**   メモリ、CPU、ディスク使用量

  **RDP疎通確認**                      ローカルでmstsc、外部から接続テスト

  **共有/AD関連確認**                  net share, net use, nltest /dsgetdc:\<domain\>
  ------------------------------------------------------------------------------------

**トラブルシュートフロー（Windows Server）**

① イベントログ確認（eventvwr）

↓

② ネットワーク疎通確認（ping, nslookup, tracert）

↓

③ サービス/リソース状態確認（taskmgr, services.msc）

↓

④ PowerShellで詳細取得（Get-EventLog, Get-Service, etc）

↓

⑤ 過去の変更/パッチを確認（Windows Update履歴）

↓

⑥ 影響範囲調査（他サーバとの連携状態など）

↓

⑦ 再起動・再適用（GPO, DNSキャッシュなど）

↓

⑧ ナレッジベース調査（Microsoft公式、Reddit, Q&Aなど）

↓

⑨ 原因究明＆恒久対応策へ

必要であれば：

- トラブルに応じた **PowerShellスニペット集**

- **ドメインコントローラー関連のトラブルまとめ**

- **Hyper-VやWSUS、IISの障害対策**

**ケース1：RDP（リモートデスクトップ）に接続できない**

**主な原因候補**

- ネットワーク切断

- RDPサービス停止

- ファイアウォールブロック

- IP制限やNLA（ネットワークレベル認証）

**トラブルシュート手順**

**① サーバー自体にPingは通るか？**

cmd

コピーする編集する

ping \<対象IP\>

- NGならネットワーク断、NIC停止、VLAN設定ミスなど

**② RDPポート（3389）が開いてるか？**

telnet \<対象IP\> 3389

- 失敗：→ FW or RDPサービスが停止している可能性大

**③ RDPサービスが起動しているか？（ローカルで確認）**

Get-Service -Name TermService

- Running でなければ起動

**④ Windowsファイアウォールの設定**

Get-NetFirewallRule -DisplayGroup \"Remote Desktop\"

- 無効になっていたら有効化：

Enable-NetFirewallRule -DisplayGroup \"Remote Desktop\"

**⑤ NLAの無効化（NLAが原因の場合）**

- ローカルGPOで無効化可能：

- gpedit.msc → コンピュータの構成 → 管理用テンプレート → システム →
  資格情報の委任

**ケース2：共有フォルダにアクセスできない**

**主な原因候補**

- SMBサービスの停止

- 共有/NTFS権限の不整合

- DNS解決失敗 or パス指定ミス

- ユーザー認証失敗（保存資格情報など）

**トラブルシュート手順**

**① 共有先にping**

ping \<ホスト名 or IP\>

**② 名前解決ができているか？**

nslookup \<ホスト名\>

- NGならDNS設定またはhostsファイルを見直し

**③ ポート445が開いているか？**

Test-NetConnection -ComputerName \<ホスト名\> -Port 445

**④ SMBサービス起動確認**

Get-Service -Name LanmanServer

- 止まっていれば：

Start-Service LanmanServer

**⑤ 共有が存在するか？**

net share

**⑥ NTFSと共有の両方のアクセス権を確認**

- GUIでも確認

- アカウントがEveryone, Authenticated Users,
  または該当グループに入っているか？

**⑦ キャッシュ資格情報削除（再認証テスト）**

cmdkey /list

cmdkey /delete:\<対象サーバ名\>

**ケース3：Windows Update適用後にサーバーが重くなる・不安定**

**主な原因候補**

- サービス暴走（Windows Defender, WMI）

- 再起動待ち or パッチ適用不完全

- イベントログ肥大

- WinSxSの肥大化

**トラブルシュート手順**

**① リソースの状態を確認**

- タスクマネージャー → CPU/メモリ使用率を見る

- 重いプロセス（svchost, MsMpEng.exe, TrustedInstaller.exe）が暴走してないか

**② Windows Updateの履歴確認**

Get-HotFix \| Sort-Object InstalledOn -Descending

**③ 未完了の更新があるか？**

Get-WindowsUpdateLog

**④ イベントログのエラー確認**

eventvwr.msc → システム or アプリケーションログ

**⑤ クリーンアップ（定期保守）**

Dism.exe /Online /Cleanup-Image /StartComponentCleanup /ResetBase

**⑥ 不具合パッチを削除する場合**

wusa /uninstall /kb:\<番号\> /quiet /norestart

**補足：RDP接続不可を自動診断するPowerShell（簡易）**

\$target = \"10.0.0.5\"

Test-Connection \$target -Count 2

Test-NetConnection -ComputerName \$target -Port 3389
