# サーバー詳細設計書

## 1. 基本情報

| 項目 | 内容 |
|------|------|
| 文書作成日 | 2025年5月23日 |
| 作成者 | のぶ |
| サーバー名 | app-server01 |
| ホスト名 | app-server.localdomain |
| 用途 | 社内Webアプリケーションホスト |
| 運用開始予定日 | 2025年6月10日 |

---

## 2. ハードウェア構成

| 項目 | スペック |
|------|----------|
| サーバー種別 | 物理サーバ |
| CPU | Intel Xeon Gold 8Core |
| メモリ | 32GB |
| ストレージ | SSD 1TB (RAID1) |
| NIC | 2ポート (bonding) |

---

## 3. OSおよびパッケージ情報

| 項目 | 内容 |
|------|------|
| OS | AlmaLinux 9.4 |
| カーネルバージョン | 5.14.0-362.el9.x86_64 |
| パッケージ管理 | dnf |
| セキュリティポリシー | SELinux: enforcing, firewalld使用 |
| タイムゾーン | Asia/Tokyo |

---

## 4. ネットワーク構成

| 項目 | 内容 |
|------|------|
| IPアドレス | 192.168.1.10 |
| サブネットマスク | 255.255.255.0 |
| デフォルトゲートウェイ | 192.168.1.1 |
| DNSサーバー | 192.168.1.53, 8.8.8.8 |
| ホスト名 | app-server.localdomain |
| ドメイン名 | localdomain |
| 備考 | NICはbond0で構成（eth0+eth1） |

---

## 5. サービス構成

| サービス名 | ソフトウェア | ポート番号 | 役割 | 備考 |
|------------|--------------|------------|------|------|
| Webサーバー | Apache HTTPD | 80, 443 | アプリ公開 | SSL対応あり |
| データベース | PostgreSQL 15 | 5432 | アプリデータ格納 | localのみ許可 |
| SSH | OpenSSH | 22 | 管理用接続 | 鍵認証のみ許可 |
| ファイアウォール | firewalld | - | 通信制御 | internalゾーン使用 |

---

## 6. ユーザーおよび権限管理

| ユーザー名 | 権限 | 備考 |
|------------|------|------|
| root | 管理者 | sudo不要 |
| appadmin | sudo可能 | サービス管理用ユーザー |
| dbuser | PostgreSQL用 | DB操作専用 |

---

## 7. ストレージ構成

| デバイス | マウントポイント | ファイルシステム | 容量 | 用途 |
|----------|------------------|------------------|------|------|
| /dev/sda1 | /boot            | xfs              | 1GB  | ブート用 |
| /dev/sda2 | /                | xfs              | 100GB| OS領域 |
| /dev/sdb1 | /var/lib/pgsql   | xfs              | 200GB| DBデータ |
| /dev/sdc1 | /backup          | xfs              | 500GB| バックアップ保存先 |

---

## 8. バックアップ設計

| 対象 | ツール | 頻度 | 保存先 | 保持期間 |
|------|--------|------|--------|----------|
| DB | pg_dump | 毎日 | /backup/db | 7日間 |
| 設定ファイル | tar | 毎週 | /backup/conf | 4週間 |
| Webコンテンツ | rsync | 毎日 | /backup/web | 7日間 |

---

## 9. ログ設計

| ログ種別 | 保存場所 | ローテーション | 保持期間 |
|----------|-----------|----------------|-----------|
| Apacheログ | /var/log/httpd/ | logrotate | 14日間 |
| PostgreSQLログ | /var/lib/pgsql/data/log/ | logrotate | 30日間 |
| システムログ | /var/log/ | logrotate | 14日間 |

---

## 10. セキュリティ設定

| 項目 | 内容 |
|------|------|
| SSH設定 | rootログイン禁止、22ポート変更 |
| ファイアウォール | 必要ポートのみ許可 |
| パッケージ管理 | 自動更新はoff、手動で管理 |
| 脆弱性スキャン | OpenVASで月1回実施予定 |

---

## 11. テスト項目（抜粋）

| テスト項目 | 目的 | 結果 |
|------------|------|------|
| ポートスキャン | 不要ポート開放なし確認 | 済 |
| Webアクセス | HTTP/HTTPS正常応答確認 | 済 |
| DB接続 | アプリ→DB接続確認 | 済 |
| SSH | 公開鍵ログイン確認 | 済 |

---

## 12. その他備考

- 監視にはZabbixを使用予定（別サーバに設置）。
- RAID状態は週次でチェック。
- 初期構築後に構成スナップショット取得。


